---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import { sanityClient, urlFor } from '../sanity';

// 1. PEDIMOS LOS 3 √öLTIMOS PRODUCTOS A SANITY
const query = `*[_type == "producto"] | order(_createdAt desc)[0..2] {
  nombre,
  precio,
  categoria,
  imagen
}`;

const productosDestacados = await sanityClient.fetch(query);
---

<Layout title="Inicio">
  <Header />
  
  <main>
    <section class="relative bg-gradient-to-r from-pink-300 to-purple-400 text-white py-24 text-center px-4 overflow-hidden">
      
      <div class="absolute top-0 left-0 w-32 h-32 bg-white opacity-20 rounded-full -translate-x-10 -translate-y-10"></div>
      <div class="absolute bottom-0 right-0 w-64 h-64 bg-white opacity-20 rounded-full translate-x-20 translate-y-20"></div>

      <div class="relative z-10 max-w-3xl mx-auto">
        <h1 class="text-5xl md:text-6xl font-bold mb-6 drop-shadow-md">
          Regalos Inolvidables para Beb√©s
        </h1>
        <p class="text-xl mb-10 opacity-95 drop-shadow-sm font-medium">
          Pasteles de pa√±ales artesanales, elegantes y pr√°cticos. El detalle perfecto para Baby Showers y Bienvenidas.
        </p>
        <a href="/productos" class="inline-block bg-white text-pink-600 px-10 py-4 rounded-full font-bold shadow-xl hover:shadow-2xl hover:scale-105 transition transform duration-300">
          Ver Cat√°logo Completo
        </a>
      </div>
    </section>

    <section class="py-16 bg-white">
      <div class="container mx-auto px-4 grid md:grid-cols-3 gap-8 text-center">
        <div class="p-6">
          <div class="text-4xl mb-4">üñêÔ∏è</div>
          <h3 class="text-xl font-bold text-gray-800 mb-2">Hecho a Mano</h3>
          <p class="text-gray-600 text-sm">Cada pieza se monta artesanalmente cuidando cada detalle.</p>
        </div>
        <div class="p-6">
          <div class="text-4xl mb-4">üë∂</div>
          <h3 class="text-xl font-bold text-gray-800 mb-2">Productos Premium</h3>
          <p class="text-gray-600 text-sm">Usamos pa√±ales Dodot y accesorios homologados para beb√©s.</p>
        </div>
        <div class="p-6">
          <div class="text-4xl mb-4">üöö</div>
          <h3 class="text-xl font-bold text-gray-800 mb-2">Env√≠o R√°pido</h3>
          <p class="text-gray-600 text-sm">Preparamos y enviamos tu regalo en 24/48 horas.</p>
        </div>
      </div>
    </section>

    <section class="container mx-auto px-4 py-20 bg-pink-50/50">
      <h2 class="text-3xl font-bold text-center mb-12 text-gray-800">√öltimas Creaciones</h2>
      
      {productosDestacados.length === 0 ? (
         <p class="text-center text-gray-500">Cargando novedades...</p>
      ) : (
        <div class="grid md:grid-cols-3 gap-8">
          {productosDestacados.map((producto) => (
            <div class="bg-white p-6 rounded-2xl shadow-sm hover:shadow-md transition border border-pink-100 flex flex-col">
              
              <div class="h-64 bg-white rounded-xl mb-4 flex items-center justify-center overflow-hidden relative">
                {producto.imagen ? (
                  <img 
                    src={urlFor(producto.imagen).width(400).height(400).url()} 
                    alt={producto.nombre}
                    class="object-contain h-full w-full p-2 hover:scale-105 transition duration-500"
                  />
                ) : (
                  <span class="text-4xl">üéÇ</span>
                )}
              </div>
              
              <div class="mt-auto">
                <h3 class="text-xl font-bold mb-2 text-gray-800">{producto.nombre}</h3>
                <div class="flex justify-between items-center mt-4">
                  <span class="text-pink-600 font-bold text-xl">{producto.precio}‚Ç¨</span>
                  <a href="/productos" class="text-sm font-semibold text-purple-600 underline hover:text-purple-800">Ver cat√°logo ‚Üí</a>
                </div>
              </div>

            </div>
          ))}
        </div>
      )}

      <div class="text-center mt-12">
        <a href="/productos" class="inline-block border-2 border-pink-500 text-pink-600 px-8 py-3 rounded-full font-bold hover:bg-pink-50 transition">
          Ver todos los pasteles
        </a>
      </div>
    </section>
  </main>

  <Footer />
</Layout>