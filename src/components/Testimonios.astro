---
// Componente de testimonios con reseñas reales de Google
const testimonios = [
  {
    nombre: "Cristina B.",
    texto: "Encargué 3 pasteles de pañales y la experiencia fue inmejorable! Una atención excelente y al detalle. El resultado de los pasteles fueron preciosos y sin duda lo recomendaría al 100%.",
    estrellas: 5
  },
  {
    nombre: "Lorena",
    texto: "Encargué este pastel para hacer un regalo a una amiga que acaba de ser mami, y quedó precioso! El envío súper rápido, muy buena calidad y a mi amiga le encantó!",
    estrellas: 5
  },
  {
    nombre: "Adri",
    texto: "Muy recomendado, es un servicio super personalizado y encantador. Utilizan productos de muy buena calidad y unos acabados increíbles.",
    estrellas: 5
  },
  {
    nombre: "Laura R.",
    texto: "Muy profesional y los resultados son increíbles! Repetiré seguro.",
    estrellas: 5
  },
  {
    nombre: "Jesús A.",
    texto: "Un detalle hecho al detalle, increíble presentación. Súper bonito para regalo a papás recientes.",
    estrellas: 5
  }
];

// Calcular rating promedio
const totalEstrellas = testimonios.reduce((acc, t) => acc + t.estrellas, 0);
const promedioEstrellas = (totalEstrellas / testimonios.length).toFixed(1);

const siteUrl = "https://www.xn--manolipastelesdepaales-1ec.com";

// Schema AggregateRating para Google
const reviewSchema = {
  "@context": "https://schema.org",
  "@type": "LocalBusiness",
  "@id": `${siteUrl}/#business`,
  "name": "Manoli Pasteles de Pañales",
  "aggregateRating": {
    "@type": "AggregateRating",
    "ratingValue": promedioEstrellas,
    "reviewCount": 15,
    "bestRating": 5,
    "worstRating": 1
  },
  "review": testimonios.map(t => ({
    "@type": "Review",
    "reviewRating": {
      "@type": "Rating",
      "ratingValue": t.estrellas,
      "bestRating": 5
    },
    "author": {
      "@type": "Person",
      "name": t.nombre
    },
    "reviewBody": t.texto
  }))
};

// Función para generar estrellas
function renderStars(count: number) {
  return '★'.repeat(count) + '☆'.repeat(5 - count);
}
---

<script type="application/ld+json" set:html={JSON.stringify(reviewSchema)} />

<section class="py-16 px-4 bg-white">
  <div class="max-w-6xl mx-auto">
    <div class="text-center mb-12">
      <h2 class="text-3xl font-bold text-gray-800 mb-4">
        Lo que dicen nuestros clientes
      </h2>
      <div class="flex items-center justify-center gap-2 mb-2">
        <span class="text-yellow-400 text-2xl">★★★★★</span>
        <span class="text-xl font-bold text-gray-800">{promedioEstrellas}</span>
      </div>
      <p class="text-gray-600">
        Basado en <a href="https://www.google.com/maps/place/Manoli+-+Pasteles+de+Pa%C3%B1ales+y+Regalos+Beb%C3%A9/@41.4500448,2.21383,3430m/data=!3m1!1e3!4m6!3m5!1s0x12a4bdea79c8fadd:0xa7d623355f33f1d4!8m2!3d41.4553211!4d2.22283!16s%2Fg%2F11ld85v9ck" target="_blank" rel="noopener" class="text-pink-600 hover:underline">15 reseñas de Google</a>
      </p>
    </div>

    <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
      {testimonios.slice(0, 3).map((testimonio) => (
        <div class="bg-pink-50 rounded-2xl p-6 border border-pink-100">
          <div class="flex items-center gap-1 text-yellow-400 mb-3">
            {renderStars(testimonio.estrellas)}
          </div>
          <p class="text-gray-700 mb-4 italic">
            "{testimonio.texto}"
          </p>
          <div class="flex items-center gap-3">
            <div class="w-10 h-10 bg-pink-200 rounded-full flex items-center justify-center text-pink-600 font-bold">
              {testimonio.nombre.charAt(0)}
            </div>
            <div>
              <p class="font-medium text-gray-800">{testimonio.nombre}</p>
              <p class="text-sm text-gray-500">Cliente verificado</p>
            </div>
          </div>
        </div>
      ))}
    </div>

    <!-- Mostrar más en móvil/tablet -->
    <div class="grid md:grid-cols-2 gap-6 mt-6 lg:hidden">
      {testimonios.slice(3, 5).map((testimonio) => (
        <div class="bg-pink-50 rounded-2xl p-6 border border-pink-100">
          <div class="flex items-center gap-1 text-yellow-400 mb-3">
            {renderStars(testimonio.estrellas)}
          </div>
          <p class="text-gray-700 mb-4 italic">
            "{testimonio.texto}"
          </p>
          <div class="flex items-center gap-3">
            <div class="w-10 h-10 bg-pink-200 rounded-full flex items-center justify-center text-pink-600 font-bold">
              {testimonio.nombre.charAt(0)}
            </div>
            <div>
              <p class="font-medium text-gray-800">{testimonio.nombre}</p>
              <p class="text-sm text-gray-500">Cliente verificado</p>
            </div>
          </div>
        </div>
      ))}
    </div>

    <div class="text-center mt-10">
      <a
        href="https://www.google.com/maps/place/Manoli+-+Pasteles+de+Pa%C3%B1ales+y+Regalos+Beb%C3%A9"
        target="_blank"
        rel="noopener"
        class="inline-flex items-center gap-2 text-pink-600 font-medium hover:underline"
      >
        <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
        </svg>
        Ver todas las reseñas en Google
      </a>
    </div>
  </div>
</section>
